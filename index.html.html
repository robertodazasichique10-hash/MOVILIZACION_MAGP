<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de √ìrdenes de Combustible - 08D01 Esmeraldas MAGP</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 5px solid #f1c40f;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .header h2 {
            font-size: 18px;
            font-weight: 300;
            opacity: 0.9;
        }

        .login-container {
            padding: 40px;
            max-width: 500px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #27ae60;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(39, 174, 96, 0.4);
        }

        .btn-secondary {
            background: #95a5a6;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-warning {
            background: #f39c12;
        }

        .hidden {
            display: none !important;
        }

        .dashboard {
            padding: 30px;
        }

        .user-info {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .user-info h3 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .role-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 5px;
        }

        .role-admin { background: #e74c3c; color: white; }
        .role-conductor { background: #3498db; color: white; }
        .role-transporte { background: #27ae60; color: white; }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .menu-card:hover {
            border-color: #27ae60;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .menu-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #27ae60;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .required::after {
            content: " *";
            color: #e74c3c;
        }

        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .signature-display {
            font-family: 'Brush Script MT', cursive;
            font-size: 24px;
            color: #2c3e50;
            padding: 20px;
            border: 2px solid #3498db;
            border-radius: 5px;
            background: #ecf0f1;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .order-list {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #27ae60;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .status-pendiente { color: #f39c12; font-weight: bold; }
        .status-firmado-conductor { color: #3498db; font-weight: bold; }
        .status-autorizado { color: #27ae60; font-weight: bold; }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            position: relative;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #000;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .pdf-preview {
            background: white;
            border: 1px solid #ddd;
            padding: 40px;
            margin: 20px 0;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .pdf-header {
            text-align: center;
            border-bottom: 3px solid #1e3c72;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .pdf-header h1 {
            color: #1e3c72;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .pdf-header h2 {
            color: #2c3e50;
            font-size: 16px;
        }

        .pdf-section {
            margin-bottom: 20px;
        }

        .pdf-section h3 {
            background: #ecf0f1;
            padding: 10px;
            color: #2c3e50;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .pdf-field {
            margin-bottom: 10px;
            display: flex;
        }

        .pdf-label {
            font-weight: bold;
            width: 200px;
            color: #34495e;
        }

        .pdf-value {
            flex: 1;
            border-bottom: 1px solid #bdc3c7;
            padding-bottom: 2px;
        }

        .signatures-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 40px;
            page-break-inside: avoid;
        }

        .signature-box {
            text-align: center;
            border-top: 1px solid #2c3e50;
            padding-top: 10px;
            margin-top: 60px;
        }

        .signature-name {
            font-weight: bold;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .signature-role {
            font-size: 10px;
            color: #7f8c8d;
        }

        .fuel-table {
            width: 100%;
            margin: 20px 0;
            border: 2px solid #27ae60;
        }

        .fuel-table th {
            background: #27ae60;
            color: white;
            padding: 10px;
            text-align: center;
        }

        .fuel-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }

        .fuel-table input {
            width: 100%;
            border: 1px solid #ddd;
            padding: 5px;
            text-align: center;
        }

        .total-row {
            background: #e8f5e9;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 18px; }
            .header h2 { font-size: 14px; }
            .form-row { grid-template-columns: 1fr; }
            .signatures-grid { grid-template-columns: 1fr; }
            .menu-grid { grid-template-columns: 1fr; }
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: #ecf0f1;
            border: none;
            margin-right: 5px;
            margin-bottom: 5px;
            border-radius: 5px 5px 0 0;
            transition: all 0.3s;
        }

        .tab.active {
            background: #27ae60;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Direcci√≥n Distrital 08D01 Esmeraldas MAGP</h1>
            <h2>Sistema de Gesti√≥n de √ìrdenes de Combustible</h2>
        </div>

        <!-- Alert Messages -->
        <div id="alertContainer" class="alert"></div>

        <!-- Login Section -->
        <div id="loginSection" class="login-container">
            <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">Iniciar Sesi√≥n</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginCedula">N√∫mero de C√©dula</label>
                    <input type="text" id="loginCedula" placeholder="Ingrese su n√∫mero de c√©dula" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Contrase√±a</label>
                    <input type="password" id="loginPassword" placeholder="Ingrese su contrase√±a" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Ingresar al Sistema</button>
            </form>
            <div style="text-align: center; margin-top: 20px;">
                <a href="#" onclick="showForgotPassword()" style="color: #27ae60; text-decoration: none;">¬øOlvid√≥ su contrase√±a?</a>
            </div>
        </div>

        <!-- Forgot Password Section -->
        <div id="forgotPasswordSection" class="login-container hidden">
            <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">Cambiar Contrase√±a</h2>
            <form id="forgotPasswordForm">
                <div class="form-group">
                    <label for="fpCedula">N√∫mero de C√©dula</label>
                    <input type="text" id="fpCedula" placeholder="Ingrese su n√∫mero de c√©dula" required>
                </div>
                <div class="form-group">
                    <label for="fpOldPassword">Contrase√±a Actual</label>
                    <input type="password" id="fpOldPassword" placeholder="Ingrese su contrase√±a actual" required>
                </div>
                <div class="form-group">
                    <label for="fpNewPassword">Nueva Contrase√±a</label>
                    <input type="password" id="fpNewPassword" placeholder="Ingrese su nueva contrase√±a" required>
                </div>
                <div class="form-group">
                    <label for="fpConfirmPassword">Confirmar Nueva Contrase√±a</label>
                    <input type="password" id="fpConfirmPassword" placeholder="Confirme su nueva contrase√±a" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Cambiar Contrase√±a</button>
                <button type="button" class="btn btn-secondary" style="width: 100%; margin-top: 10px;" onclick="showLogin()">Volver al Login</button>
            </form>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboardSection" class="dashboard hidden">
            <div class="user-info">
                <div>
                    <h3 id="userNameDisplay">Nombre del Usuario</h3>
                    <span id="userRoleDisplay" class="role-badge">Rol</span>
                    <p style="margin-top: 10px; color: #7f8c8d; font-size: 14px;">C√©dula: <span id="userCedulaDisplay"></span></p>
                </div>
                <div>
                    <button class="btn btn-secondary" onclick="logout()">Cerrar Sesi√≥n</button>
                    <button class="btn btn-warning" onclick="showChangePassword()">Cambiar Contrase√±a</button>
                </div>
            </div>

            <!-- Admin Dashboard -->
            <div id="adminDashboard" class="hidden">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalUsers">86</div>
                        <div class="stat-label">Usuarios Registrados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalOrders">0</div>
                        <div class="stat-label">√ìrdenes Generadas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingOrders">0</div>
                        <div class="stat-label">Pendientes de Autorizaci√≥n</div>
                    </div>
                </div>

                <div class="tabs">
                    <button class="tab active" onclick="showTab('userManagement')">Gesti√≥n de Usuarios</button>
                    <button class="tab" onclick="showTab('allOrders')">Todas las √ìrdenes</button>
                </div>

                <div id="userManagement" class="tab-content active">
                    <h3>Crear Nuevo Usuario</h3>
                    <form id="createUserForm" class="form-section">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="required">C√©dula</label>
                                <input type="text" id="newUserCedula" required>
                            </div>
                            <div class="form-group">
                                <label class="required">Nombres y Apellidos</label>
                                <input type="text" id="newUserName" required>
                            </div>
                            <div class="form-group">
                                <label class="required">Rol</label>
                                <select id="newUserRole" required>
                                    <option value="">Seleccione...</option>
                                    <option value="conductor">Conductor</option>
                                    <option value="transporte">Responsable de Transporte</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">Crear Usuario</button>
                    </form>

                    <h3 style="margin-top: 30px;">Lista de Usuarios</h3>
                    <div class="order-list">
                        <table id="usersTable">
                            <thead>
                                <tr>
                                    <th>C√©dula</th>
                                    <th>Nombre</th>
                                    <th>Rol</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <div id="allOrders" class="tab-content">
                    <h3>Todas las √ìrdenes de Combustible</h3>
                    <div class="order-list">
                        <table id="allOrdersTable">
                            <thead>
                                <tr>
                                    <th>N¬∞ Orden</th>
                                    <th>Fecha</th>
                                    <th>Conductor</th>
                                    <th>Total Galones</th>
                                    <th>Valor Total</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="allOrdersTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Conductor Dashboard -->
            <div id="conductorDashboard" class="hidden">
                <div class="menu-grid">
                    <div class="menu-card" onclick="showCreateOrder()">
                        <div style="font-size: 40px; color: #27ae60; margin-bottom: 15px;">‚õΩ</div>
                        <h3>Nueva Orden de Combustible</h3>
                        <p>Solicitar combustible para veh√≠culo</p>
                    </div>
                    <div class="menu-card" onclick="showMyOrders()">
                        <div style="font-size: 40px; color: #27ae60; margin-bottom: 15px;">üìã</div>
                        <h3>Mis √ìrdenes</h3>
                        <p>Ver historial de solicitudes</p>
                    </div>
                </div>

                <!-- Create Order Form -->
                <div id="createOrderForm" class="hidden">
                    <h3 style="margin-bottom: 20px;">Nueva Orden de Combustible</h3>
                    <form id="orderForm">
                        <div class="form-section">
                            <h3>Informaci√≥n de la Entidad</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nombre de la Entidad</label>
                                    <input type="text" value="DIRECCI√ìN DISTRITAL 08D01 ESMERALDAS MAGP" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Direcci√≥n</label>
                                    <input type="text" value="PEDRO VIVENTE MALDONADO Y MANUELA CA√ëIZAREZ" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Tel√©fono</label>
                                    <input type="text" value="063700590 Ext. 6" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Informaci√≥n del Conductor y Veh√≠culo</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nombre del Conductor</label>
                                    <input type="text" id="conductorNombre" readonly>
                                </div>
                                <div class="form-group">
                                    <label>C√©dula del Conductor</label>
                                    <input type="text" id="conductorCedula" readonly>
                                </div>
                                <div class="form-group">
                                    <label class="required">Placa del Veh√≠culo</label>
                                    <input type="text" id="placaVehiculo" required>
                                    <span class="error-message">Campo obligatorio</span>
                                </div>
                                <div class="form-group">
                                    <label class="required">Kilometraje Actual</label>
                                    <input type="number" id="kilometraje" min="0" required>
                                    <span class="error-message">Campo obligatorio</span>
                                </div>
                                <div class="form-group">
                                    <label class="required">Fecha de Solicitud</label>
                                    <input type="date" id="fechaSolicitud" required>
                                    <span class="error-message">Campo obligatorio</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Detalle de Combustible y Servicios</h3>
                            <table class="fuel-table">
                                <thead>
                                    <tr>
                                        <th>Tipo</th>
                                        <th>Galones</th>
                                        <th>Valor Unitario ($)</th>
                                        <th>Valor Total ($)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>SUPER</td>
                                        <td><input type="number" id="galSuper" class="fuel-input" min="0" step="0.01" value="0" onchange="calculateTotals()"></td>
                                        <td><input type="number" id="valSuper" class="fuel-input" min="0" step="0.01" value="0" onchange="calculateTotals()"></td>
                                        <td id="totalSuper">0.00</td>
                                    </tr>
                                    <tr>
                                        <td>EXTRA</td>
                                        <td><input type="number" id="galExtra" class="fuel-input" min="0" step="0.01" value="0" onchange="calculateTotals()"></td>
                                        <td><input type="number" id="valExtra" class="fuel-input" min="0" step="0.01" value="0" onchange="calculateTotals()"></td>
                                        <td id="totalExtra">0.00</td>
                                    </tr>
                                    <tr>
                                        <td>DIESEL</td>
                                        <td><input type="number" id="galDiesel" class="fuel-input" min="0" step="0.01" value="0" onchange="calculateTotals()"></td>
                                        <td><input type="number" id="valDiesel" class="fuel-input" min="0" step="0.01" value="0" onchange="calculateTotals()"></td>
                                        <td id="totalDiesel">0.00</td>
                                    </tr>
                                    <tr>
                                        <td>LUBRICANTES</td>
                                        <td><input type="number" id="galLubricantes" class="fuel-input" min="0" step="0.01" value="0" onchange="calculateTotals()"></td>
                                        <td><input type="number" id="valLubricantes" class="fuel-input" min="0" step="0.01" value="0" onchange="calculateTotals()"></td>
                                        <td id="totalLubricantes">0.00</td>
                                    </tr>
                                    <tr>
                                        <td>LAVADO</td>
                                        <td><input type="number" id="galLavado" class="fuel-input" min="0" step="0.01" value="0" onchange="calculateTotals()"></td>
                                        <td><input type="number" id="valLavado" class="fuel-input" min="0" step="0.01" value="0" onchange="calculateTotals()"></td>
                                        <td id="totalLavado">0.00</td>
                                    </tr>
                                    <tr class="total-row">
                                        <td><strong>TOTAL GALONES</strong></td>
                                        <td><input type="number" id="totalGalones" min="0" step="0.01" value="0" readonly style="font-weight: bold; background: #e8f5e9;"></td>
                                        <td><strong>SUBTOTAL</strong></td>
                                        <td id="subTotal">0.00</td>
                                    </tr>
                                    <tr>
                                        <td colspan="2"></td>
                                        <td><strong>IVA %</strong></td>
                                        <td><input type="number" id="ivaPorcentaje" min="0" max="100" step="0.01" value="15" onchange="calculateTotals()" style="width: 60px; display: inline;"> %</td>
                                    </tr>
                                    <tr class="total-row">
                                        <td colspan="2"></td>
                                        <td><strong>VALOR IVA ($)</strong></td>
                                        <td id="valorIva">0.00</td>
                                    </tr>
                                    <tr class="total-row" style="background: #c8e6c9;">
                                        <td colspan="2"></td>
                                        <td><strong>TOTAL A PAGAR ($)</strong></td>
                                        <td id="totalPagar" style="font-size: 18px; color: #2e7d32;">0.00</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="form-section">
                            <h3>Motivo de la Solicitud</h3>
                            <div class="form-group">
                                <label class="required">Justificaci√≥n / Ruta a realizar</label>
                                <textarea id="motivoSolicitud" rows="3" required></textarea>
                                <span class="error-message">Campo obligatorio</span>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Firma Electr√≥nica del Conductor</h3>
                            <p style="margin-bottom: 15px; color: #7f8c8d;">Al guardar esta orden, se registrar√° su firma electr√≥nica:</p>
                            <div class="signature-display" id="conductorSignatureDisplay">
                                Firma Digital del Conductor
                            </div>
                        </div>

                        <div style="margin-top: 30px;">
                            <button type="submit" class="btn btn-success">Guardar y Firmar Orden</button>
                            <button type="button" class="btn btn-secondary" onclick="cancelOrder()">Cancelar</button>
                        </div>
                    </form>
                </div>

                <!-- My Orders List -->
                <div id="myOrdersList" class="hidden">
                    <h3 style="margin-bottom: 20px;">Mis √ìrdenes de Combustible</h3>
                    <div class="order-list">
                        <table id="myOrdersTable">
                            <thead>
                                <tr>
                                    <th>N¬∞ Orden</th>
                                    <th>Fecha</th>
                                    <th>Placa</th>
                                    <th>Total Galones</th>
                                    <th>Valor Total</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="myOrdersTableBody"></tbody>
                        </table>
                    </div>
                    <button class="btn btn-secondary" onclick="showConductorMenu()" style="margin-top: 20px;">Volver al Men√∫</button>
                </div>
            </div>

            <!-- Responsable Transporte Dashboard -->
            <div id="transporteDashboard" class="hidden">
                <div class="menu-grid">
                    <div class="menu-card" onclick="showPendingOrdersTransporte()">
                        <div style="font-size: 40px; color: #27ae60; margin-bottom: 15px;">‚è≥</div>
                        <h3>√ìrdenes Pendientes</h3>
                        <p>√ìrdenes esperando autorizaci√≥n</p>
                    </div>
                    <div class="menu-card" onclick="showAuthorizedOrders()">
                        <div style="font-size: 40px; color: #27ae60; margin-bottom: 15px;">‚úÖ</div>
                        <h3>√ìrdenes Autorizadas</h3>
                        <p>Historial de autorizaciones</p>
                    </div>
                </div>

                <div id="pendingOrdersTransporte" class="hidden">
                    <h3 style="margin-bottom: 20px;">√ìrdenes Pendientes de Autorizaci√≥n</h3>
                    <div class="order-list">
                        <table id="pendingTransporteTable">
                            <thead>
                                <tr>
                                    <th>N¬∞ Orden</th>
                                    <th>Fecha</th>
                                    <th>Conductor</th>
                                    <th>Placa</th>
                                    <th>Valor Total</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="pendingTransporteTableBody"></tbody>
                        </table>
                    </div>
                    <button class="btn btn-secondary" onclick="showTransporteMenu()" style="margin-top: 20px;">Volver</button>
                </div>
            </div>
        </div>

        <!-- Order Detail Modal -->
        <div id="orderModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <div id="orderDetailContent"></div>
            </div>
        </div>

        <!-- PDF Preview Container (Hidden) -->
        <div id="pdfContent" style="display: none;"></div>
    </div>

    <script>
        // Base de datos de usuarios inicial (86 usuarios + admin)
        const initialUsers = [
            { cedula: "0801550096", nombre: "ROBERTO ANTONIO DAZA SICHIQUE", rol: "administrador", password: "0801550096", activo: true },
            { cedula: "0801671090", nombre: "CHICA VALENCIA AMABLE ANTONIO", rol: "conductor", password: "0801671090", activo: true },
            { cedula: "1311423683", nombre: "MARCILLO OCHOA EDUARDO JAVIER", rol: "conductor", password: "1311423683", activo: true },
            { cedula: "0801587890", nombre: "VALVERDE SANCHEZ CARLOS EDUARDO", rol: "conductor", password: "0801587890", activo: true },
            { cedula: "0802872598", nombre: "ESPINOZA LOZA LENNY PRISCILA", rol: "conductor", password: "0802872598", activo: true },
            { cedula: "0802440495", nombre: "CEDE√ëO REQUENE CARMEN ISABEL", rol: "conductor", password: "0802440495", activo: true },
            { cedula: "0914087879", nombre: "BAZAN PRECIADO JECICA ELENA", rol: "conductor", password: "0914087879", activo: true },
            { cedula: "0800899536", nombre: "VALENCIA CAICEDO COLON FRANCISCO", rol: "conductor", password: "0800899536", activo: true },
            { cedula: "1304230343", nombre: "RIVERA ESCOBEDO ARTURO JOHNNY", rol: "conductor", password: "1304230343", activo: true },
            { cedula: "0801666371", nombre: "PADILLA CHUQUIMARCA MARTHA ESTRELLA", rol: "conductor", password: "0801666371", activo: true },
            { cedula: "0802320606", nombre: "CAMPOS OBANDO FLOR MARIA", rol: "conductor", password: "0802320606", activo: true },
            { cedula: "0802159962", nombre: "ESTUPI√ëAN DIAZ NELSON PAUL", rol: "conductor", password: "0802159962", activo: true },
            { cedula: "0802259416", nombre: "QUI√ëONEZ CUERO JENIFER NATALIA", rol: "conductor", password: "0802259416", activo: true },
            { cedula: "0801461740", nombre: "FONSECA PINARGOTE GARY LOBERTTY", rol: "conductor", password: "0801461740", activo: true },
            { cedula: "0802860221", nombre: "YELA ANGULO JESSICA OLINDA", rol: "conductor", password: "0802860221", activo: true },
            { cedula: "0000000001", nombre: "SOLIS MENDEZ GINA MARIEL", rol: "transporte", password: "0000000001", activo: true },
            { cedula: "0801822552", nombre: "MERA ESTERILLA MILTON ESTALIN", rol: "conductor", password: "0801822552", activo: true },
            { cedula: "0804371664", nombre: "CASTRO BONE MARIA GABRIELA", rol: "conductor", password: "0804371664", activo: true },
            { cedula: "0804497238", nombre: "CAICEDO CAICEDO HENRRY DAVID", rol: "conductor", password: "0804497238", activo: true },
            { cedula: "0803463587", nombre: "DELGADO MENDOZA MARIA ANGELICA", rol: "conductor", password: "0803463587", activo: true },
            { cedula: "0803290352", nombre: "GUERRERO DE LA CRUZ JOSE GUILBERT", rol: "conductor", password: "0803290352", activo: true },
            { cedula: "0801587338", nombre: "ESTRELLA VALDERRAMA ANDRES FELIPE", rol: "conductor", password: "0801587338", activo: true },
            { cedula: "0802547018", nombre: "ZAMBRANO VILELA MARIO ALEXANDER", rol: "conductor", password: "0802547018", activo: true },
            { cedula: "0802881094", nombre: "ARGUELLO TELLO JORGE ANDRES", rol: "conductor", password: "0802881094", activo: true },
            { cedula: "1720782653", nombre: "SEGURA BENAVIDES SOFIA RAQUEL", rol: "conductor", password: "1720782653", activo: true },
            { cedula: "0802236471", nombre: "ALAVA MURILLO DORA MARITZA", rol: "conductor", password: "0802236471", activo: true },
            { cedula: "0801104977", nombre: "ANGULO WININTER FRIXON REMBERTO", rol: "conductor", password: "0801104977", activo: true },
            { cedula: "0804393635", nombre: "CAICEDO AYOVI JAIDAN MARLON", rol: "conductor", password: "0804393635", activo: true },
            { cedula: "1003613526", nombre: "MATOS FUENTES HENRY MELECIO", rol: "conductor", password: "1003613526", activo: true },
            { cedula: "0801686361", nombre: "MIRANDA QUINTERO PABLO CESAR", rol: "conductor", password: "0801686361", activo: true },
            { cedula: "0800673220", nombre: "MONTA√ëO ESTACIO NEFER ROSENDA", rol: "conductor", password: "0800673220", activo: true },
            { cedula: "0803138544", nombre: "MERCADO QUI√ëONES MARTHA ANDREA", rol: "conductor", password: "0803138544", activo: true },
            { cedula: "1725888554", nombre: "MOREIRA MOROCHO ALEXIS DARIO", rol: "conductor", password: "1725888554", activo: true },
            { cedula: "0802577858", nombre: "MOREIRA QUI√ëONEZ JOHN ALEJANDRO", rol: "conductor", password: "0802577858", activo: true },
            { cedula: "0802772806", nombre: "NEVAREZ AVELLAN GILMER JAVIER", rol: "conductor", password: "0802772806", activo: true },
            { cedula: "0926011941", nombre: "ORELLANA BUESTAN ROXANA VANESSA", rol: "conductor", password: "0926011941", activo: true },
            { cedula: "0802311357", nombre: "ORTIZ ZAMBRANO PABLO XAVIER", rol: "conductor", password: "0802311357", activo: true },
            { cedula: "0802588582", nombre: "PARRALES VALENZUELA DAVID ALEXANDER", rol: "conductor", password: "0802588582", activo: true },
            { cedula: "2300505803", nombre: "PALMA PINCAY JOHN HENRY", rol: "conductor", password: "2300505803", activo: true },
            { cedula: "0802275099", nombre: "QUI√ëONEZ AYOVI GLORIA DIXIANA", rol: "conductor", password: "0802275099", activo: true },
            { cedula: "0802774158", nombre: "QUI√ëONEZ SAAVEDRA MARCELO ALEJANDRO", rol: "conductor", password: "0802774158", activo: true },
            { cedula: "1716820632", nombre: "QUISHPE CA√ëAR IVAN SANTIAGO", rol: "conductor", password: "1716820632", activo: true },
            { cedula: "0802605931", nombre: "QUIROZ ALAVA DIEGO ARMANDO", rol: "conductor", password: "0802605931", activo: true },
            { cedula: "0802507079", nombre: "RAMIREZ VALENCIA JACKSON ULISES", rol: "conductor", password: "0802507079", activo: true },
            { cedula: "0802328666", nombre: "REYES JAMA FIDEL PATRICIO", rol: "conductor", password: "0802328666", activo: true },
            { cedula: "0801861006", nombre: "ROSALES MOREIRA DAVID ROLANDO", rol: "conductor", password: "0801861006", activo: true },
            { cedula: "1309695276", nombre: "RODRIGUEZ HIDALGO ERNESTO ANTONIO", rol: "conductor", password: "1309695276", activo: true },
            { cedula: "0850584517", nombre: "VELEZ ROSADO WELLINGTON JAVIER", rol: "conductor", password: "0850584517", activo: true },
            { cedula: "0801890039", nombre: "VALDEZ CAICEDO VRIMAN ESPA√ëA", rol: "conductor", password: "0801890039", activo: true },
            { cedula: "1304194283", nombre: "ZAMBRANO CHAVEZ CRISTOBAL COLON", rol: "conductor", password: "1304194283", activo: true },
            { cedula: "0800858490", nombre: "ALVAREZ SEVILLANO FELIX ARCESIO", rol: "conductor", password: "0800858490", activo: true },
            { cedula: "0919043182", nombre: "CABRERA ORRALA RONALD ULISES", rol: "conductor", password: "0919043182", activo: true },
            { cedula: "0802138222", nombre: "CAICEDO MERLIN DARIO JAVIER", rol: "conductor", password: "0802138222", activo: true },
            { cedula: "1309587309", nombre: "FALCONES RIVERO DANIEL SIGIFREDO", rol: "conductor", password: "1309587309", activo: true },
            { cedula: "1312187592", nombre: "INTRIAGO BRITO JONATHAN ADRIAN", rol: "conductor", password: "1312187592", activo: true },
            { cedula: "0801252073", nombre: "MINA ARBOLEDA ABEL EFREN", rol: "conductor", password: "0801252073", activo: true },
            { cedula: "0802772129", nombre: "RAMIREZ TIMARAN DIANA JOANNA", rol: "conductor", password: "0802772129", activo: true },
            { cedula: "1311542516", nombre: "TIPAN ALCIVAR LUIS ALBERTO", rol: "conductor", password: "1311542516", activo: true },
            { cedula: "0801611880", nombre: "ANDRADE PEREA LUIS ENRIQUE", rol: "conductor", password: "0801611880", activo: true },
            { cedula: "0803150259", nombre: "CAMACHO TELLO KAREN INDIRA", rol: "conductor", password: "0803150259", activo: true },
            { cedula: "0802132696", nombre: "HIDALGO VERA ANGEL KLEBER", rol: "conductor", password: "0802132696", activo: true },
            { cedula: "1206243782", nombre: "JIMENEZ GUERRERO JEFFERSON FABRICIO", rol: "conductor", password: "1206243782", activo: true },
            { cedula: "0803805613", nombre: "PRADO BONE YILIO ALBERTO", rol: "conductor", password: "0803805613", activo: true },
            { cedula: "0802679654", nombre: "VIVAR SOSA EDDY DANIEL", rol: "conductor", password: "0802679654", activo: true },
            { cedula: "1313572313", nombre: "GARCIA ARTEAGA RODRIGO ANDRES", rol: "conductor", password: "1313572313", activo: true },
            { cedula: "1311660714", nombre: "BRIONES ALAVA CESAR OSWALDO", rol: "conductor", password: "1311660714", activo: true },
            { cedula: "0801883026", nombre: "BARREZUETA MALDONADO ALEXIS ALBERTO", rol: "conductor", password: "0801883026", activo: true },
            { cedula: "1712295904", nombre: "LOOR DAVILA DANILO ANDRE", rol: "conductor", password: "1712295904", activo: true },
            { cedula: "1726634544", nombre: "ARIAS SALAMEA ADRIAN ALEJANDRO", rol: "conductor", password: "1726634544", activo: true },
            { cedula: "0803129865", nombre: "TREJO MONTA√ëO ERICK ADRIAN", rol: "conductor", password: "0803129865", activo: true },
            { cedula: "0802521153", nombre: "CEDE√ëO PORTOCARRERO JAVIER EMILIO", rol: "conductor", password: "0802521153", activo: true },
            { cedula: "0802130799", nombre: "QUINTERO ALAVA FRANK", rol: "conductor", password: "0802130799", activo: true },
            { cedula: "0802834804", nombre: "CASTILLO OLIVO DARWIN FABRICIO", rol: "conductor", password: "0802834804", activo: true },
            { cedula: "0802836296", nombre: "CHICA RAMIREZ FELIX PAUL", rol: "conductor", password: "0802836296", activo: true },
            { cedula: "0801534363", nombre: "MOSQUERA CUERO MARYS YAQUELINE", rol: "conductor", password: "0801534363", activo: true },
            { cedula: "0804569093", nombre: "AVELLAN REALPE AQUILES ELIAS", rol: "conductor", password: "0804569093", activo: true },
            { cedula: "0802077651", nombre: "ZAMBRANO ROSERO ANTONIO SIGIFREDO", rol: "conductor", password: "0802077651", activo: true },
            { cedula: "0804374346", nombre: "COELLO ZAMBRANO KIMBERLY CRISTINA", rol: "conductor", password: "0804374346", activo: true },
            { cedula: "0941574428", nombre: "REYES RODRIGUEZ JAZMIN YANINE", rol: "conductor", password: "0941574428", activo: true },
            { cedula: "0801712282", nombre: "ANGULO ALEGRIA JACOB CLEOFE", rol: "conductor", password: "0801712282", activo: true },
            { cedula: "0802018069", nombre: "JAMA ALVEAR GINO CLEMENTE", rol: "conductor", password: "0802018069", activo: true },
            { cedula: "0802503375", nombre: "GAMEZ LEMA ALEX MARCOS", rol: "conductor", password: "0802503375", activo: true },
            { cedula: "0801758756", nombre: "LARA QUI√ëONEZ FABRICIO REGULO", rol: "conductor", password: "0801758756", activo: true },
            { cedula: "0803235548", nombre: "GRACIA PALACIOS MARIA ROSA", rol: "conductor", password: "0803235548", activo: true },
            { cedula: "0802944686", nombre: "QUI√ëONEZ FLORES LEIDY TAMARA", rol: "conductor", password: "0802944686", activo: true }
        ];

        // Estado global
        let currentUser = null;
        let users = [];
        let orders = [];

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();
        });

        function loadData() {
            // Cargar usuarios desde localStorage o usar los iniciales
            const savedUsers = localStorage.getItem('combustible_users');
            if (savedUsers) {
                users = JSON.parse(savedUsers);
            } else {
                users = [...initialUsers];
                saveUsers();
            }

            // Cargar √≥rdenes
            const savedOrders = localStorage.getItem('combustible_orders');
            if (savedOrders) {
                orders = JSON.parse(savedOrders);
            }
        }

        function saveUsers() {
            localStorage.setItem('combustible_users', JSON.stringify(users));
        }

        function saveOrders() {
            localStorage.setItem('combustible_orders', JSON.stringify(orders));
        }

        function setupEventListeners() {
            // Login
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Forgot password
            document.getElementById('forgotPasswordForm').addEventListener('submit', handlePasswordChange);
            
            // Create user (admin)
            document.getElementById('createUserForm')?.addEventListener('submit', handleCreateUser);
            
            // Create order (conductor)
            document.getElementById('orderForm')?.addEventListener('submit', handleCreateOrder);
        }

        function handleLogin(e) {
            e.preventDefault();
            const cedula = document.getElementById('loginCedula').value.trim();
            const password = document.getElementById('loginPassword').value;

            const user = users.find(u => u.cedula === cedula && u.password === password && u.activo);

            if (user) {
                currentUser = user;
                showDashboard();
            } else {
                showAlert('C√©dula o contrase√±a incorrectos', 'error');
            }
        }

        function showDashboard() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('forgotPasswordSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');

            // Actualizar info de usuario
            document.getElementById('userNameDisplay').textContent = currentUser.nombre;
            document.getElementById('userCedulaDisplay').textContent = currentUser.cedula;
            
            const roleBadge = document.getElementById('userRoleDisplay');
            roleBadge.textContent = currentUser.rol;
            roleBadge.className = 'role-badge role-' + currentUser.rol;

            // Mostrar dashboard seg√∫n rol
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('conductorDashboard').classList.add('hidden');
            document.getElementById('transporteDashboard').classList.add('hidden');

            if (currentUser.rol === 'administrador') {
                document.getElementById('adminDashboard').classList.remove('hidden');
                loadAdminDashboard();
            } else if (currentUser.rol === 'conductor') {
                document.getElementById('conductorDashboard').classList.remove('hidden');
                setupConductorDashboard();
            } else if (currentUser.rol === 'transporte') {
                document.getElementById('transporteDashboard').classList.remove('hidden');
            }
        }

        function setupConductorDashboard() {
            // Pre-llenar datos del conductor
            document.getElementById('conductorNombre').value = currentUser.nombre;
            document.getElementById('conductorCedula').value = currentUser.cedula;
            document.getElementById('conductorSignatureDisplay').textContent = currentUser.nombre;
            
            // Establecer fecha actual
            document.getElementById('fechaSolicitud').valueAsDate = new Date();
        }

        function loadAdminDashboard() {
            // Estad√≠sticas
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalOrders').textContent = orders.length;
            document.getElementById('pendingOrders').textContent = orders.filter(o => o.estado === 'firmado-conductor').length;

            // Cargar tabla de usuarios
            loadUsersTable();
        }

        function loadUsersTable() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${user.cedula}</td>
                    <td>${user.nombre}</td>
                    <td><span class="role-badge role-${user.rol}">${user.rol}</span></td>
                    <td>${user.activo ? 'Activo' : 'Inactivo'}</td>
                    <td>
                        <button class="btn btn-warning" onclick="resetPassword('${user.cedula}')" style="padding: 5px 10px; font-size: 12px;">Resetear Clave</button>
                        ${user.rol !== 'administrador' ? `<button class="btn btn-danger" onclick="toggleUser('${user.cedula}')" style="padding: 5px 10px; font-size: 12px;">${user.activo ? 'Desactivar' : 'Activar'}</button>` : ''}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function handleCreateUser(e) {
            e.preventDefault();
            const cedula = document.getElementById('newUserCedula').value.trim();
            const nombre = document.getElementById('newUserName').value.trim().toUpperCase();
            const rol = document.getElementById('newUserRole').value;

            if (users.find(u => u.cedula === cedula)) {
                showAlert('Ya existe un usuario con esa c√©dula', 'error');
                return;
            }

            users.push({
                cedula: cedula,
                nombre: nombre,
                rol: rol,
                password: cedula,
                activo: true
            });

            saveUsers();
            loadUsersTable();
            document.getElementById('createUserForm').reset();
            showAlert('Usuario creado exitosamente', 'success');
        }

        function resetPassword(cedula) {
            const user = users.find(u => u.cedula === cedula);
            if (user) {
                user.password = cedula;
                saveUsers();
                showAlert(`Contrase√±a reseteada para ${user.nombre}`, 'success');
            }
        }

        function toggleUser(cedula) {
            const user = users.find(u => u.cedula === cedula);
            if (user && user.rol !== 'administrador') {
                user.activo = !user.activo;
                saveUsers();
                loadUsersTable();
                showAlert(`Usuario ${user.activo ? 'activado' : 'desactivado'}`, 'success');
            }
        }

        function calculateTotals() {
            // Obtener valores
            const galSuper = parseFloat(document.getElementById('galSuper').value) || 0;
            const valSuper = parseFloat(document.getElementById('valSuper').value) || 0;
            const galExtra = parseFloat(document.getElementById('galExtra').value) || 0;
            const valExtra = parseFloat(document.getElementById('valExtra').value) || 0;
            const galDiesel = parseFloat(document.getElementById('galDiesel').value) || 0;
            const valDiesel = parseFloat(document.getElementById('valDiesel').value) || 0;
            const galLubricantes = parseFloat(document.getElementById('galLubricantes').value) || 0;
            const valLubricantes = parseFloat(document.getElementById('valLubricantes').value) || 0;
            const galLavado = parseFloat(document.getElementById('galLavado').value) || 0;
            const valLavado = parseFloat(document.getElementById('valLavado').value) || 0;
            const ivaPorcentaje = parseFloat(document.getElementById('ivaPorcentaje').value) || 15;

            // Calcular totales por tipo
            const totalSuper = galSuper * valSuper;
            const totalExtra = galExtra * valExtra;
            const totalDiesel = galDiesel * valDiesel;
            const totalLubricantes = galLubricantes * valLubricantes;
            const totalLavado = galLavado * valLavado;

            // Mostrar totales por tipo
            document.getElementById('totalSuper').textContent = totalSuper.toFixed(2);
            document.getElementById('totalExtra').textContent = totalExtra.toFixed(2);
            document.getElementById('totalDiesel').textContent = totalDiesel.toFixed(2);
            document.getElementById('totalLubricantes').textContent = totalLubricantes.toFixed(2);
            document.getElementById('totalLavado').textContent = totalLavado.toFixed(2);

            // Calcular totales generales
            const totalGalones = galSuper + galExtra + galDiesel + galLubricantes + galLavado;
            const subTotal = totalSuper + totalExtra + totalDiesel + totalLubricantes + totalLavado;
            const valorIva = subTotal * (ivaPorcentaje / 100);
            const totalPagar = subTotal + valorIva;

            // Mostrar totales
            document.getElementById('totalGalones').value = totalGalones.toFixed(2);
            document.getElementById('subTotal').textContent = subTotal.toFixed(2);
            document.getElementById('valorIva').textContent = valorIva.toFixed(2);
            document.getElementById('totalPagar').textContent = totalPagar.toFixed(2);
        }

        function showCreateOrder() {
            document.getElementById('createOrderForm').classList.remove('hidden');
            document.getElementById('myOrdersList').classList.add('hidden');
            
            // Resetear formulario
            document.getElementById('orderForm').reset();
            document.getElementById('conductorNombre').value = currentUser.nombre;
            document.getElementById('conductorCedula').value = currentUser.cedula;
            document.getElementById('fechaSolicitud').valueAsDate = new Date();
            calculateTotals();
        }

        function cancelOrder() {
            document.getElementById('createOrderForm').classList.add('hidden');
            document.getElementById('orderForm').reset();
        }

        function handleCreateOrder(e) {
            e.preventDefault();

            // Validar campos obligatorios
            const requiredFields = ['placaVehiculo', 'kilometraje', 'fechaSolicitud', 'motivoSolicitud'];
            let valid = true;
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    valid = false;
                    field.style.borderColor = '#e74c3c';
                } else {
                    field.style.borderColor = '#e0e0e0';
                }
            });

            if (!valid) {
                showAlert('Por favor complete todos los campos obligatorios', 'error');
                return;
            }

            // Validar que haya al menos un producto
            const totalGalones = parseFloat(document.getElementById('totalGalones').value) || 0;
            if (totalGalones <= 0) {
                showAlert('Debe ingresar al menos un gal√≥n de combustible o servicio', 'error');
                return;
            }

            // Generar n√∫mero de orden
            const conductorOrders = orders.filter(o => o.conductorCedula === currentUser.cedula);
            const orderNumber = `${currentUser.cedula}-${String(conductorOrders.length + 1).padStart(3, '0')}`;

            const order = {
                id: Date.now().toString(),
                numeroOrden: orderNumber,
                fechaCreacion: new Date().toISOString(),
                
                // Entidad
                entidadNombre: "DIRECCI√ìN DISTRITAL 08D01 ESMERALDAS MAGP",
                entidadDireccion: "PEDRO VIVENTE MALDONADO Y MANUELA CA√ëIZAREZ",
                entidadTelefono: "063700590 Ext. 6",
                
                // Conductor
                conductorCedula: currentUser.cedula,
                conductorNombre: currentUser.nombre,
                
                // Veh√≠culo
                placaVehiculo: document.getElementById('placaVehiculo').value.toUpperCase(),
                kilometraje: document.getElementById('kilometraje').value,
                fechaSolicitud: document.getElementById('fechaSolicitud').value,
                
                // Combustible
                combustible: {
                    super: { galones: parseFloat(document.getElementById('galSuper').value) || 0, valorUnitario: parseFloat(document.getElementById('valSuper').value) || 0, total: parseFloat(document.getElementById('totalSuper').textContent) || 0 },
                    extra: { galones: parseFloat(document.getElementById('galExtra').value) || 0, valorUnitario: parseFloat(document.getElementById('valExtra').value) || 0, total: parseFloat(document.getElementById('totalExtra').textContent) || 0 },
                    diesel: { galones: parseFloat(document.getElementById('galDiesel').value) || 0, valorUnitario: parseFloat(document.getElementById('valDiesel').value) || 0, total: parseFloat(document.getElementById('totalDiesel').textContent) || 0 },
                    lubricantes: { galones: parseFloat(document.getElementById('galLubricantes').value) || 0, valorUnitario: parseFloat(document.getElementById('valLubricantes').value) || 0, total: parseFloat(document.getElementById('totalLubricantes').textContent) || 0 },
                    lavado: { galones: parseFloat(document.getElementById('galLavado').value) || 0, valorUnitario: parseFloat(document.getElementById('valLavado').value) || 0, total: parseFloat(document.getElementById('totalLavado').textContent) || 0 }
                },
                
                // Totales
                totalGalones: parseFloat(document.getElementById('totalGalones').value) || 0,
                subTotal: parseFloat(document.getElementById('subTotal').textContent) || 0,
                ivaPorcentaje: parseFloat(document.getElementById('ivaPorcentaje').value) || 15,
                valorIva: parseFloat(document.getElementById('valorIva').textContent) || 0,
                totalPagar: parseFloat(document.getElementById('totalPagar').textContent) || 0,
                
                // Motivo
                motivoSolicitud: document.getElementById('motivoSolicitud').value.toUpperCase(),
                
                // Firmas
                firmaConductor: currentUser.nombre,
                firmaConductorFecha: new Date().toISOString(),
                firmaTransporte: null,
                firmaTransporteFecha: null,
                
                // Estado
                estado: 'firmado-conductor'
            };

            orders.push(order);
            saveOrders();

            showAlert(`Orden de combustible ${orderNumber} creada y firmada exitosamente`, 'success');
            showMyOrders();
        }

        function showMyOrders() {
            document.getElementById('createOrderForm').classList.add('hidden');
            document.getElementById('myOrdersList').classList.remove('hidden');

            const tbody = document.getElementById('myOrdersTableBody');
            tbody.innerHTML = '';

            const myOrders = orders.filter(o => o.conductorCedula === currentUser.cedula)
                                  .sort((a, b) => new Date(b.fechaCreacion) - new Date(a.fechaCreacion));

            myOrders.forEach(order => {
                const tr = document.createElement('tr');
                
                let actionButtons = `<button class="btn" onclick="viewOrder('${order.id}')" style="padding: 5px 10px; font-size: 12px;">Ver</button>`;
                
                if (order.estado === 'firmado-conductor') {
                    actionButtons += ` <button class="btn btn-success" onclick="sendToTransporte('${order.id}')" style="padding: 5px 10px; font-size: 12px;">Enviar a Transporte</button>`;
                } else if (order.estado === 'enviado-transporte') {
                    actionButtons += ` <span style="color: #3498db; font-size: 12px;">‚è≥ Esperando autorizaci√≥n</span>`;
                } else if (order.estado === 'autorizado') {
                    actionButtons += ` <span style="color: #27ae60; font-size: 12px;">‚úì Autorizado</span>`;
                }
                
                tr.innerHTML = `
                    <td>${order.numeroOrden}</td>
                    <td>${formatDate(order.fechaSolicitud)}</td>
                    <td>${order.placaVehiculo}</td>
                    <td>${order.totalGalones.toFixed(2)}</td>
                    <td>$ ${order.totalPagar.toFixed(2)}</td>
                    <td class="status-${order.estado.replace('-', '-')}">${getStatusText(order.estado)}</td>
                    <td>${actionButtons}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function sendToTransporte(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.estado = 'enviado-transporte';
                saveOrders();
                showMyOrders();
                showAlert('Orden enviada al Responsable de Transporte para autorizaci√≥n', 'success');
            }
        }

        function showPendingOrdersTransporte() {
            document.getElementById('transporteDashboard').classList.add('hidden');
            document.getElementById('pendingOrdersTransporte').classList.remove('hidden');

            const tbody = document.getElementById('pendingTransporteTableBody');
            tbody.innerHTML = '';

            const pendingOrders = orders.filter(o => o.estado === 'enviado-transporte');

            pendingOrders.forEach(order => {
                const conductor = users.find(u => u.cedula === order.conductorCedula);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${order.numeroOrden}</td>
                    <td>${formatDate(order.fechaSolicitud)}</td>
                    <td>${conductor ? conductor.nombre : 'N/A'}</td>
                    <td>${order.placaVehiculo}</td>
                    <td>$ ${order.totalPagar.toFixed(2)}</td>
                    <td>
                        <button class="btn" onclick="viewOrder('${order.id}')" style="padding: 5px 10px; font-size: 12px;">Ver</button>
                        <button class="btn btn-success" onclick="autorizarTransporte('${order.id}')" style="padding: 5px 10px; font-size: 12px;">Autorizar</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function autorizarTransporte(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.firmaTransporte = "AUTORIZADO - SOLIS MENDEZ GINA MARIEL";
                order.firmaTransporteFecha = new Date().toISOString();
                order.estado = 'autorizado';
                saveOrders();
                showPendingOrdersTransporte();
                showAlert('Orden de combustible autorizada exitosamente', 'success');
            }
        }

        function viewOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const modal = document.getElementById('orderModal');
            const content = document.getElementById('orderDetailContent');
            
            const conductor = users.find(u => u.cedula === order.conductorCedula);

            content.innerHTML = `
                <div class="pdf-preview">
                    <div class="pdf-header">
                        <h1>DIRECCI√ìN DISTRITAL 08D01 ESMERALDAS MAGP</h1>
                        <h2>ORDEN DE COMBUSTIBLE N¬∞ ${order.numeroOrden}</h2>
                        <div id="qrcode" style="margin-top: 20px;"></div>
                    </div>

                    <div class="pdf-section">
                        <h3>INFORMACI√ìN DE LA ENTIDAD</h3>
                        <div class="pdf-field">
                            <span class="pdf-label">Nombre:</span>
                            <span class="pdf-value">${order.entidadNombre}</span>
                        </div>
                        <div class="pdf-field">
                            <span class="pdf-label">Direcci√≥n:</span>
                            <span class="pdf-value">${order.entidadDireccion}</span>
                        </div>
                        <div class="pdf-field">
                            <span class="pdf-label">Tel√©fono:</span>
                            <span class="pdf-value">${order.entidadTelefono}</span>
                        </div>
                    </div>

                    <div class="pdf-section">
                        <h3>INFORMACI√ìN DEL CONDUCTOR Y VEH√çCULO</h3>
                        <div class="pdf-field">
                            <span class="pdf-label">Conductor:</span>
                            <span class="pdf-value">${order.conductorNombre}</span>
                        </div>
                        <div class="pdf-field">
                            <span class="pdf-label">C√©dula:</span>
                            <span class="pdf-value">${order.conductorCedula}</span>
                        </div>
                        <div class="pdf-field">
                            <span class="pdf-label">Placa Veh√≠culo:</span>
                            <span class="pdf-value">${order.placaVehiculo}</span>
                        </div>
                        <div class="pdf-field">
                            <span class="pdf-label">Kilometraje:</span>
                            <span class="pdf-value">${order.kilometraje} km</span>
                        </div>
                        <div class="pdf-field">
                            <span class="pdf-label">Fecha Solicitud:</span>
                            <span class="pdf-value">${formatDate(order.fechaSolicitud)}</span>
                        </div>
                    </div>

                    <div class="pdf-section">
                        <h3>DETALLE DE COMBUSTIBLE Y SERVICIOS</h3>
                        <table class="fuel-table" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>Tipo</th>
                                    <th>Galones</th>
                                    <th>Valor Unitario ($)</th>
                                    <th>Valor Total ($)</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${order.combustible.super.galones > 0 ? `
                                <tr>
                                    <td>SUPER</td>
                                    <td>${order.combustible.super.galones.toFixed(2)}</td>
                                    <td>${order.combustible.super.valorUnitario.toFixed(2)}</td>
                                    <td>${order.combustible.super.total.toFixed(2)}</td>
                                </tr>` : ''}
                                ${order.combustible.extra.galones > 0 ? `
                                <tr>
                                    <td>EXTRA</td>
                                    <td>${order.combustible.extra.galones.toFixed(2)}</td>
                                    <td>${order.combustible.extra.valorUnitario.toFixed(2)}</td>
                                    <td>${order.combustible.extra.total.toFixed(2)}</td>
                                </tr>` : ''}
                                ${order.combustible.diesel.galones > 0 ? `
                                <tr>
                                    <td>DIESEL</td>
                                    <td>${order.combustible.diesel.galones.toFixed(2)}</td>
                                    <td>${order.combustible.diesel.valorUnitario.toFixed(2)}</td>
                                    <td>${order.combustible.diesel.total.toFixed(2)}</td>
                                </tr>` : ''}
                                ${order.combustible.lubricantes.galones > 0 ? `
                                <tr>
                                    <td>LUBRICANTES</td>
                                    <td>${order.combustible.lubricantes.galones.toFixed(2)}</td>
                                    <td>${order.combustible.lubricantes.valorUnitario.toFixed(2)}</td>
                                    <td>${order.combustible.lubricantes.total.toFixed(2)}</td>
                                </tr>` : ''}
                                ${order.combustible.lavado.galones > 0 ? `
                                <tr>
                                    <td>LAVADO</td>
                                    <td>${order.combustible.lavado.galones.toFixed(2)}</td>
                                    <td>${order.combustible.lavado.valorUnitario.toFixed(2)}</td>
                                    <td>${order.combustible.lavado.total.toFixed(2)}</td>
                                </tr>` : ''}
                                <tr class="total-row">
                                    <td><strong>TOTAL GALONES</strong></td>
                                    <td><strong>${order.totalGalones.toFixed(2)}</strong></td>
                                    <td><strong>SUBTOTAL</strong></td>
                                    <td><strong>${order.subTotal.toFixed(2)}</strong></td>
                                </tr>
                                <tr>
                                    <td colspan="2"></td>
                                    <td><strong>IVA ${order.ivaPorcentaje}%</strong></td>
                                    <td>${order.valorIva.toFixed(2)}</td>
                                </tr>
                                <tr class="total-row" style="background: #c8e6c9;">
                                    <td colspan="2"></td>
                                    <td><strong>TOTAL A PAGAR ($)</strong></td>
                                    <td style="font-size: 16px; color: #2e7d32;"><strong>${order.totalPagar.toFixed(2)}</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="pdf-section">
                        <h3>MOTIVO DE LA SOLICITUD</h3>
                        <div class="pdf-field">
                            <span class="pdf-value">${order.motivoSolicitud}</span>
                        </div>
                    </div>

                    <div class="signatures-grid">
                        <div class="signature-box">
                            <div class="signature-display" style="font-size: 16px; min-height: 40px; margin-bottom: 10px;">
                                ${order.firmaConductor || 'PENDIENTE'}
                            </div>
                            <div class="signature-name">${order.firmaConductor || ''}</div>
                            <div class="signature-role">CONDUCTOR (SOLICITANTE)</div>
                            <div style="font-size: 10px; color: #7f8c8d;">
                                ${order.firmaConductorFecha ? formatDateTime(order.firmaConductorFecha) : ''}
                            </div>
                        </div>

                        <div class="signature-box">
                            <div class="signature-display" style="font-size: 16px; min-height: 40px; margin-bottom: 10px;">
                                ${order.firmaTransporte || 'PENDIENTE'}
                            </div>
                            <div class="signature-name">SOLIS MENDEZ GINA MARIEL</div>
                            <div class="signature-role">RESPONSABLE DE TRANSPORTE (AUTORIZA)</div>
                            <div style="font-size: 10px; color: #7f8c8d;">
                                ${order.firmaTransporteFecha ? formatDateTime(order.firmaTransporteFecha) : ''}
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-success" onclick="generatePDF('${order.id}')">Descargar PDF</button>
                    <button class="btn btn-secondary" onclick="closeModal()">Cerrar</button>
                </div>
            `;

            // Generar QR
            setTimeout(() => {
                new QRCode(document.getElementById("qrcode"), {
                    text: `COMBUSTIBLE:${order.numeroOrden}|COND:${order.conductorCedula}|FECHA:${order.fechaSolicitud}|TOTAL:${order.totalPagar}`,
                    width: 100,
                    height: 100
                });
            }, 100);

            modal.style.display = 'block';
        }

        function generatePDF(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFont("helvetica");
            
            // Header
            doc.setFontSize(16);
            doc.setTextColor(30, 60, 114);
            doc.text("DIRECCI√ìN DISTRITAL 08D01 ESMERALDAS MAGP", 105, 20, { align: "center" });
            
            doc.setFontSize(14);
            doc.text(`ORDEN DE COMBUSTIBLE N¬∞ ${order.numeroOrden}`, 105, 30, { align: "center" });
            
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            doc.text(`C√≥digo QR: COMBUSTIBLE:${order.numeroOrden}`, 105, 40, { align: "center" });

            let y = 50;

            const addSection = (title, fields) => {
                doc.setFontSize(12);
                doc.setTextColor(30, 60, 114);
                doc.text(title, 20, y);
                y += 8;
                
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                fields.forEach(([label, value]) => {
                    doc.setFont("helvetica", "bold");
                    doc.text(`${label}:`, 20, y);
                    doc.setFont("helvetica", "normal");
                    const splitValue = doc.splitTextToSize(value, 150);
                    doc.text(splitValue, 70, y);
                    y += 6 * splitValue.length;
                });
                y += 5;
            };

            addSection("INFORMACI√ìN DE LA ENTIDAD", [
                ["Nombre", order.entidadNombre],
                ["Direcci√≥n", order.entidadDireccion],
                ["Tel√©fono", order.entidadTelefono]
            ]);

            addSection("INFORMACI√ìN DEL CONDUCTOR", [
                ["Conductor", order.conductorNombre],
                ["C√©dula", order.conductorCedula],
                ["Placa", order.placaVehiculo],
                ["Kilometraje", `${order.kilometraje} km`],
                ["Fecha", formatDate(order.fechaSolicitud)]
            ]);

            // Tabla de combustible
            y += 5;
            doc.setFontSize(11);
            doc.setTextColor(30, 60, 114);
            doc.text("DETALLE DE COMBUSTIBLE", 105, y, { align: "center" });
            y += 10;

            // Encabezados de tabla
            doc.setFillColor(39, 174, 96);
            doc.rect(20, y-5, 170, 8, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(9);
            doc.text("Tipo", 25, y);
            doc.text("Galones", 60, y);
            doc.text("V. Unitario", 95, y);
            doc.text("V. Total", 140, y);
            y += 8;

            // Datos
            doc.setTextColor(0, 0, 0);
            const items = [
                ["SUPER", order.combustible.super],
                ["EXTRA", order.combustible.extra],
                ["DIESEL", order.combustible.diesel],
                ["LUBRICANTES", order.combustible.lubricantes],
                ["LAVADO", order.combustible.lavado]
            ];

            items.forEach(([tipo, datos]) => {
                if (datos.galones > 0) {
                    doc.text(tipo, 25, y);
                    doc.text(datos.galones.toFixed(2), 60, y);
                    doc.text(`$${datos.valorUnitario.toFixed(2)}`, 95, y);
                    doc.text(`$${datos.total.toFixed(2)}`, 140, y);
                    y += 6;
                }
            });

            // Totales
            y += 2;
            doc.setFont("helvetica", "bold");
            doc.text(`TOTAL GALONES: ${order.totalGalones.toFixed(2)}`, 25, y);
            doc.text(`SUBTOTAL: $${order.subTotal.toFixed(2)}`, 95, y);
            y += 6;
            doc.text(`IVA ${order.ivaPorcentaje}%: $${order.valorIva.toFixed(2)}`, 95, y);
            y += 6;
            doc.setFontSize(12);
            doc.setTextColor(39, 174, 96);
            doc.text(`TOTAL A PAGAR: $${order.totalPagar.toFixed(2)}`, 95, y);

            // Firmas
            y += 20;
            doc.setFontSize(11);
            doc.setTextColor(30, 60, 114);
            doc.text("FIRMAS", 105, y, { align: "center" });
            y += 15;

            const signatures = [
                ["CONDUCTOR\n(SOLICITANTE)", order.firmaConductor || "PENDIENTE", order.firmaConductorFecha ? formatDateTime(order.firmaConductorFecha) : ""],
                ["RESPONSABLE DE\nTRANSPORTE\n(AUTORIZA)", order.firmaTransporte || "PENDIENTE", order.firmaTransporteFecha ? formatDateTime(order.firmaTransporteFecha) : ""]
            ];

            const colWidth = 85;
            const startX = 20;

            signatures.forEach((sig, index) => {
                const x = startX + (index * colWidth);
                
                doc.line(x, y, x + 70, y);
                
                doc.setFontSize(9);
                doc.setTextColor(0, 0, 0);
                doc.setFont("helvetica", "bold");
                const lines = doc.splitTextToSize(sig[0], 70);
                doc.text(lines, x + 35, y + 5, { align: "center" });
                
                doc.setFont("helvetica", "italic");
                doc.setFontSize(8);
                doc.text(sig[1], x + 35, y + 15, { align: "center" });
                
                doc.setFont("helvetica", "normal");
                doc.setFontSize(7);
                doc.setTextColor(127, 140, 141);
                doc.text(sig[2], x + 35, y + 20, { align: "center" });
            });

            doc.save(`Orden_Combustible_${order.numeroOrden}.pdf`);
        }

        function closeModal() {
            document.getElementById('orderModal').style.display = 'none';
        }

        function showConductorMenu() {
            document.getElementById('createOrderForm').classList.add('hidden');
            document.getElementById('myOrdersList').classList.add('hidden');
        }

        function showTransporteMenu() {
            document.getElementById('pendingOrdersTransporte').classList.add('hidden');
            document.getElementById('transporteDashboard').classList.remove('hidden');
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'allOrders') {
                loadAllOrdersTable();
            }
        }

        function loadAllOrdersTable() {
            const tbody = document.getElementById('allOrdersTableBody');
            tbody.innerHTML = '';

            const sortedOrders = [...orders].sort((a, b) => new Date(b.fechaCreacion) - new Date(a.fechaCreacion));

            sortedOrders.forEach(order => {
                const conductor = users.find(u => u.cedula === order.conductorCedula);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${order.numeroOrden}</td>
                    <td>${formatDate(order.fechaSolicitud)}</td>
                    <td>${conductor ? conductor.nombre : 'N/A'}</td>
                    <td>${order.totalGalones.toFixed(2)}</td>
                    <td>$ ${order.totalPagar.toFixed(2)}</td>
                    <td class="status-${order.estado.replace('-', '-')}">${getStatusText(order.estado)}</td>
                    <td>
                        <button class="btn" onclick="viewOrder('${order.id}')" style="padding: 5px 10px; font-size: 12px;">Ver</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function showForgotPassword() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('forgotPasswordSection').classList.remove('hidden');
        }

        function showLogin() {
            document.getElementById('forgotPasswordSection').classList.add('hidden');
            document.getElementById('loginSection').classList.remove('hidden');
        }

        function handlePasswordChange(e) {
            e.preventDefault();
            const cedula = document.getElementById('fpCedula').value.trim();
            const oldPass = document.getElementById('fpOldPassword').value;
            const newPass = document.getElementById('fpNewPassword').value;
            const confirmPass = document.getElementById('fpConfirmPassword').value;

            const user = users.find(u => u.cedula === cedula && u.password === oldPass);
            
            if (!user) {
                showAlert('C√©dula o contrase√±a actual incorrectos', 'error');
                return;
            }

            if (newPass !== confirmPass) {
                showAlert('Las nuevas contrase√±as no coinciden', 'error');
                return;
            }

            if (newPass.length < 4) {
                showAlert('La nueva contrase√±a debe tener al menos 4 caracteres', 'error');
                return;
            }

            user.password = newPass;
            saveUsers();
            showAlert('Contrase√±a cambiada exitosamente', 'success');
            document.getElementById('forgotPasswordForm').reset();
            setTimeout(showLogin, 1500);
        }

        function showChangePassword() {
            document.getElementById('fpCedula').value = currentUser.cedula;
            showForgotPassword();
        }

        function logout() {
            currentUser = null;
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('loginForm').reset();
        }

        function showAlert(message, type) {
            const alert = document.getElementById('alertContainer');
            alert.textContent = message;
            alert.className = `alert alert-${type}`;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('es-EC');
        }

        function formatDateTime(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleString('es-EC');
        }

        function getStatusText(status) {
            const statuses = {
                'firmado-conductor': 'Firmada por Conductor',
                'enviado-transporte': 'Enviada a Transporte',
                'autorizado': 'Autorizada'
            };
            return statuses[status] || status;
        }

        // Cerrar modal al hacer clic fuera
        window.onclick = function(event) {
            const modal = document.getElementById('orderModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>